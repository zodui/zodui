# è¿ç®—ç±»å‹

å¦‚æœä½ å¯¹ TypeScript æœ‰æ‰€äº†è§£ï¼Œé‚£ä¹ˆä½ åº”è¯¥çŸ¥é“ TypeScript ä¸­çš„ç±»å‹è¿ç®—ç¬¦ï¼ŒZod ä¹Ÿæ”¯æŒäº†ä¸€äº›ç±»å‹è¿ç®—ç¬¦ï¼Œè¿™äº›ç±»å‹è¿ç®—ç¬¦å¯ä»¥å¸®åŠ©ä½ æ›´å¥½çš„æè¿°ä½ çš„ç±»å‹ã€‚

## è”åˆç±»å‹

åœ¨ TypeScript ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡ `|`ï¼ˆè”åˆï¼‰ è¿ç®—ç¬¦æ¥å®ç°çš„ï¼ŒåŒæ ·çš„ Zod ä¹Ÿæ”¯æŒäº†è¿™ä¸€ç§ç±»å‹è¿ç®—çš„å®šä¹‰æ–¹å¼ï¼Œé€šè¿‡ä½¿ç”¨ `z.union` ä¾¿å¯ä»¥å®šä¹‰ä½ éœ€è¦çš„è”åˆç±»å‹ã€‚

åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥å…ˆè§‚å¯Ÿä¸€ä¸ªæœ€ç®€å•çš„è”åˆç±»å‹çš„ä¾‹å­ã€‚

```typescript zodui:preview
[
  z
    .union([
      z.string().label('å­—ç¬¦ä¸²'),
      z.number().label('æ•°å­—')
    ])
    .label('å­—ç¬¦ä¸²æˆ–æ•°å­—')
    .describe(
      'è”åˆåŸºç¡€ç±»å‹çš„æƒ…å†µä¸‹ï¼Œè¾“å…¥æ¡†é¦–å…ˆå°†ä¼šæ¸²æŸ“ä¸ºä¸€ä¸ªä¸‹æ‹‰æ¡†ï¼Œä½ å¯ä»¥é€šè¿‡å•å‡»ä¸‹æ‹‰æ¡†æ¥é€‰æ‹©éœ€è¦çš„ç±»å‹ã€‚\n' +
      'ä¸‹æ‹‰æ¡†çš„é€‰é¡¹çš„æ–‡æœ¬ç”±å¯¹åº”çš„ç±»å‹çš„ label å±æ€§å†³å®šï¼Œä½ å¯ä»¥é€šè¿‡ label å±æ€§æ¥ä¿®æ”¹å¯¹åº”çš„æ–‡æœ¬ã€‚\n' +
      'å½“ä½ é€‰æ‹©äº†å¯¹åº”çš„ç±»å‹ä¹‹åï¼Œè¾“å…¥æ¡†å°†ä¼šæ¸²æŸ“ä¸ºå¯¹åº”çš„ç±»å‹çš„è¾“å…¥æ¡†ï¼Œä½ å¯ä»¥é€šè¿‡äº¤äº’æ¥è¾“å…¥å¯¹åº”çš„å†…å®¹ã€‚'
    ),
  z
    .union([
      z.literal('a').label('A'),
      z.literal('b').label('B'),
      z.literal(true),
      z.literal(1).label('æ•°å­— 1'),
      z.literal({
        type: 'ç±»å‹',
        name: 'åç§°'
      }).label('ä¸€ä¸ªå¯¹è±¡')
    ])
    .label('A æˆ– B æˆ–è€…å…¶ä»–çš„ literalï¼ˆå­—é¢é‡ï¼‰ ç±»å‹')
    .describe(
      'è”åˆ literalï¼ˆå­—é¢é‡ï¼‰ç±»å‹çš„æƒ…å†µä¸‹ï¼Œè¾“å…¥æ¡†é¦–å…ˆå°†ä¼šæ¸²æŸ“ä¸ºä¸€ä¸ªä¸‹æ‹‰æ¡†ï¼Œä½ å¯ä»¥é€šè¿‡å•å‡»ä¸‹æ‹‰æ¡†æ¥é€‰æ‹©éœ€è¦çš„ç±»å‹ã€‚'
    )
]
```

> ç›¸å¯¹äºæŸä¸€ç±»[ç‰¹æ®Šçš„ç±»å‹](#è¡¨å•çš„è”åŠ¨)æ¥è¯´åœ¨ TypeScript ä¸­å®ƒå¯è¢«ç§°ä½œä¸º[ã€ŒAlgebraic Data Typesï¼ˆä»£æ•°æ•°æ®ç±»å‹ï¼‰ã€](https://zh.wikipedia.org/zh-cn/%E4%BB%A3%E6%95%B0%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B)ã€‚

### å¯ä¾›è°ƒæ•´çš„äº¤äº’æ¨¡å¼

é™¤äº†é»˜è®¤çš„ select äº¤äº’æ¨¡å¼ä½ è¿˜å¯ä»¥é€‰æ‹©ä½¿ç”¨ radio çš„æ–¹å¼æ¥è¿›è¡Œæ¸²æŸ“ï¼Œä½ å¯ä»¥é€šè¿‡ `z.union` çš„ `mode` æ–¹æ³•æ¥è¿›è¡Œè®¾ç½®ã€‚

```typescript zodui:preview
[
  z
    .union([
      z.literal('a').label('A'),
      z.literal('b').label('B'),
      z.literal(1).label('æ•°å­— 1'),
      z.literal({
        type: 'ç±»å‹',
        name: 'åç§°'
      }).label('ä¸€ä¸ªå¯¹è±¡')
    ])
    .mode('radio')
    .label('A/B/C?')
    .describe(
      'è”åˆ literalï¼ˆå­—é¢é‡ï¼‰ç±»å‹çš„æƒ…å†µä¸‹ï¼Œè¾“å…¥æ¡†é¦–å…ˆå°†ä¼šæ¸²æŸ“ä¸ºä¸€ä¸ªå•é€‰æ¡†ï¼Œä½ å¯ä»¥é€šè¿‡å•å‡»å•é€‰æ¡†æ¥é€‰æ‹©éœ€è¦çš„ç±»å‹ã€‚\n' +
      'å•é€‰æ¡†çš„é€‰é¡¹çš„æ–‡æœ¬ç”±å¯¹åº”çš„ç±»å‹çš„ label å±æ€§å†³å®šï¼Œä½ å¯ä»¥é€šè¿‡ label å±æ€§æ¥ä¿®æ”¹å¯¹åº”çš„æ–‡æœ¬ã€‚'
    ),
  z
    .union([
      z.literal('a').label('A'),
      z.literal('b').label('B'),
      z.literal(1).label('æ•°å­— 1')
    ])
    .mode('radio direction-column')
    .label('A/B/C?')
    .describe('å•é€‰æ¡†çš„æ–¹å‘å¯ä»¥é€šè¿‡ `direction-column` æ¥è¿›è¡Œè®¾ç½®ã€‚'),
  z
    .union([
      z.literal('a').label('A'),
      z.literal('b').label('B'),
      z.literal(1).label('æ•°å­— 1')
    ])
    .mode('radio direction-column wrap')
    .label('A/B/C?')
    .describe('å¦‚æœåœ¨å³ä¾§çš„ç©ºé—´ä¸è¶³ä»¥å®¹çº³æ‰€æœ‰çš„é€‰é¡¹ï¼Œå¯ä»¥é€šè¿‡ `wrap` æ¥è®¾ç½®åˆ‡æ¢åˆ°ä¸‹ä¸€è¡Œã€‚'),
  z
    .union([
      z.literal('a').label('A'),
      z.literal('b').label('B')
    ])
    .mode('radio-outline')
    .label('A/B')
    .describe('æ¢ä¸ªæ ·å­ï¼Ÿ'),
  z
    .union([
      z.literal('a').label('A'),
      z.literal('b').label('B')
    ])
    .mode('radio-card')
    .label('A/B/C?')
    .describe('è¿˜æ˜¯è¯´ä½ å–œæ¬¢è¿™ä¸ªï¼Ÿ'),
]
```

### æ’å…¥åœ¨ä¸‹æ–¹çš„é€‰é¡¹

ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä¼šé€‰æ‹©å°†é€‰é¡¹ç›´æ¥æ”¾åœ¨å³ä¾§çš„æ“ä½œåŒºåŸŸå†…ï¼Œä½†æ˜¯æœ‰äº›åœºæ™¯ä¸‹å…¶å®æˆ‘ä»¬æ˜¯æ²¡åŠæ³•ä»å³ä¾§äº¤äº’æ¥è¿›è¡Œæ“ä½œçš„ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯èƒ½ä¼šæƒ³åˆ° `wrap` çš„æ¨¡å¼ï¼Œä½†æ˜¯è¿™ä¸ªçš„èƒ½åŠ›ä¹Ÿä¸æ˜¯æ— é™çš„ã€‚\
ä½†æ˜¯åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡æä¾›äº†ä¸€ä¸ª `append` çš„æ¨¡å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªæ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†é€‰é¡¹æ’å…¥åˆ°ä¸‹æ–¹çš„æ“ä½œåŒºåŸŸå†…ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸‹æ–¹çš„æ“ä½œåŒºåŸŸæ¥è¿›è¡Œäº¤äº’äº†ã€‚

```typescript zodui:preview
z
  .union([
    z.literal(false).label('ä¸æ„¿é€éœ²'),
    z.object({
      name: z.string().label('åç§°'),
      birthday: z
        .date()
        .mode('datetime panel wrap')
        .label('ç”Ÿæ—¥')
    }).label('åŸºæœ¬ä¿¡æ¯'),
  ])
  .mode('append')
  .label('A/B/C?')
  .describe(
    'é€šè¿‡ `append` æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†é€‰é¡¹æ’å…¥åˆ°ä¸‹æ–¹æ–°çš„æ“ä½œåŒºåŸŸå†…ï¼Œç°åœ¨ä½ å¯ä»¥é€‰æ‹©å³ä¾§çš„`å¡«å†™ä¿¡æ¯`é€‰é¡¹è¯•è¯•çœ‹ã€‚'
  )
```

### è¡¨å•çš„è”åŠ¨

æ­¤å¤–ï¼Œä½ ä¹Ÿå¯ä»¥å–„ç”¨è”åˆç±»å‹æ¥å®ç°ä¸€äº›è¾ƒä¸ºå¤æ‚çš„è¡¨å•è”åŠ¨çš„éœ€æ±‚ã€‚

> ç†Ÿæ‚‰ TypeScript çš„åº”è¯¥å¯¹ã€ŒDiscriminated Unionï¼ˆé‰´åˆ«å¼è”åˆï¼‰ã€æˆ–ç§°ã€ŒTagged Unionï¼ˆæ ‡è®°å¼è”åˆï¼‰ã€çš„è¿™ä¸ªæ¦‚å¿µä¸ä¼šé™Œç”Ÿï¼Œå¦‚æœä¸è®°å¾—äº†å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»å®˜æ–¹çš„å®šä¹‰ [TypeScript Handbook/narrowing#discriminated-unions](https://www.typescriptlang.org/docs/handbook/2/narrowing.html#discriminated-unions)ã€‚\
> é™¤æ­¤ä¹‹å¤–ä½ è¿˜å¯ä»¥é˜…è¯»ã€Œ[ä»€ä¹ˆæ˜¯é‰´åˆ«å¼è”åˆç±»å‹ï¼Ÿ](https://www.geeksforgeeks.org/what-are-discriminated-union-types/)ã€å¯¹å…¶è¿›è¡Œè¿›ä¸€æ­¥çš„äº†è§£ã€‚

å‡è®¾æˆ‘ä»¬æ­£åœ¨è®¾è®¡ä¸€ä¸ªè¡¨å•ï¼Œè¿™ä¸ªè¡¨å•ä¸­æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼Œåˆ†åˆ«æ˜¯ `A` å’Œ `B`ï¼Œå½“æˆ‘ä»¬é€‰æ‹©äº† `A` çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¡«å†™ `åç§°`ï¼Œå½“æˆ‘ä»¬é€‰æ‹©äº† `B` çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¡«å†™ `å¹´é¾„`ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è”åˆç±»å‹æ¥å®ç°è¿™ä¸ªéœ€æ±‚ã€‚\
é¦–å…ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ TypeScript å¯¹ç±»å‹è¿›è¡Œå®šä¹‰ï¼Œç„¶åå†å°†å…¶è½¬æ¢ä¸º Zod çš„ç±»å‹ã€‚

```typescript
type AOrB =
| {
  type: 'a'
  name: string
}
| {
  type: 'b'
  age: number
}
```

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [`zod.discriminatedUnion`](https://zod.dev/?id=discriminated-unions) æ¥å®ç°è¿™ä¸ªéœ€æ±‚ï¼Œè¿™ä¸ªæ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²æ˜¯ç”¨æ¥åŒºåˆ†è”åˆç±»å‹çš„ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„ä¸­åŒ…å«äº†æ‰€æœ‰çš„è”åˆç±»å‹çš„å®šä¹‰ã€‚\
åœ¨è¿™é‡Œæˆ‘ä»¬å°† `type` ä½œä¸ºåŒºåˆ†è”åˆç±»å‹çš„å…ƒç´ ï¼Œç„¶åå°† `A` å’Œ `B` ä½œä¸ºè”åˆç±»å‹çš„å®šä¹‰ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å®ç°è¿™ä¸ªéœ€æ±‚äº†ã€‚

```typescript zodui:preview
[
  z
    .discriminatedUnion('type', [
      z.object({
        type: z.literal('a').label('A'),
        name: z.string().label('åç§°')
      }),
      z.object({
        type: z.literal('b').label('B'),
        age: z.number().mode('split').label('å¹´é¾„')
      })
    ])
    .label('A/B?')
    .describe(
      'ç°åœ¨ä½ å¯ä»¥é€‰æ‹©å³ä¾§çš„`A`æˆ–`B`é€‰é¡¹è¯•è¯•çœ‹ã€‚'
    ),
  z
    .discriminatedUnion('displayAge', [
      z.object({
        name: z.string().label('åç§°'),
        displayAge: z.literal(false).label('æ˜¾ç¤ºå¹´é¾„')
      }),
      z.object({
        name: z.string().label('åç§°'),
        displayAge: z.literal(true).label('æ˜¾ç¤ºå¹´é¾„'),
        age: z.number().mode('split').label('å¹´é¾„')
      })
    ])
    .label('å¼€å…³')
    .describe(
      'è§‰å¾—å¹´é¾„ä¿¡æ¯æ— æ‰€è°“ï¼Ÿè¯•è¯•ç‚¹å‡»å³ä¾§çš„`æ˜¾ç¤ºå¹´é¾„`é€‰é¡¹ã€‚'
    )
]
```

æ²¡å†™å¥½ï¼Œæ²¡æƒ³å¥½ï¼Œæ²¡è®¾è®¡å¥½ï¼Œåˆ«çœ‹è¿™å—ğŸ˜­ï¼ˆ~~æˆ–è€…ä¸€èµ·æ¥å»ºè®¾~~ï¼‰ã€‚

```typescript zodui:preview
z
  .union([
    z.object({
      type: z.string(),
    }),
    z.object({
      type: z.literal('a').label('A'),
      name: z.string().label('åç§°')
    }),
    z.object({
      type: z.literal('b').label('B'),
      age: z.number().label('å¹´é¾„')
    })
  ])
```

## äº¤å‰ç±»å‹

åœ¨ TypeScript ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡ `&`ï¼ˆäº¤å‰ï¼‰ è¿ç®—ç¬¦æ¥å®ç°çš„ï¼ŒåŒæ ·çš„ Zod ä¹Ÿæ”¯æŒäº†è¿™ä¸€ç§ç±»å‹è¿ç®—çš„å®šä¹‰æ–¹å¼ï¼Œé€šè¿‡ä½¿ç”¨ `z.intersection` ä¾¿å¯ä»¥å®šä¹‰ä½ éœ€è¦çš„äº¤å‰ç±»å‹ã€‚

```typescript zodui:preview
z
  .intersection(
    z
      .object({
        name: z.string().label('åç§°'),
        age: z.number().label('å¹´é¾„')
      })
      .label('åŸºç¡€ä¿¡æ¯'),
    z
      .object({
        location: z.string().label('ä½ç½®'),
        address: z.string().label('åœ°å€')
      })
      .label('èƒŒæ™¯ä¿¡æ¯')
  )
  .label('åç§°ä¸å¹´é¾„')
  .describe('äº¤å‰ç±»å‹çš„æƒ…å†µä¸‹ï¼Œè¾“å…¥æ¡†å°†ä¼šæ¸²æŸ“ä¸ºä¸¤ä¸ªè¾“å…¥æ¡†ï¼Œä½ å¯ä»¥é€šè¿‡äº¤äº’æ¥è¾“å…¥å¯¹åº”çš„å†…å®¹ã€‚')
```
